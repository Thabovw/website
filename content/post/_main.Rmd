---
title: "Hello R Markdown"
author: "Frida Gomam"
date: 2015-07-23T21:13:14-05:00
categories: ["R"]
tags: ["R Markdown", "plot", "regression"]
draft: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

# R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

You can embed an R code chunk like this:

```{r cars}
summary(cars)
fit <- lm(dist ~ speed, data = cars)
fit
```

# Including Plots

You can also embed plots. See Figure \@ref(fig:pie) for example:

```{r pie, fig.cap='A fancy pie chart.', tidy=FALSE}
par(mar = c(0, 1, 0, 1))
pie(
  c(280, 60, 20),
  c('Sky', 'Sunny side of pyramid', 'Shady side of pyramid'),
  col = c('#0292D8', '#F7EA39', '#C4B632'),
  init.angle = -50, border = NA
)
```

<!--chapter:end:2015-07-23-r-rmarkdown.Rmd-->

---
title: "Jaccard Index"
author: "T van Woudenberg"
date: 2019-08-29T12:00:00-15:00
categories: ["R"]
tags: ["Igraph", "social networks", "Jaccard index"]
draft: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

# Jaccard 

Hi all! 

I while ago, I had the problem that I wanted to compare the edges between different networks. To be more specific, I wanted to compare the edges in Social network based on a nomination question ("With whom do you spend time during the breaks at school") to the edges based on bluetooth connects of participants' smartphones (more info see <https://bmcpublichealth.biomedcentral.com/articles/10.1186/s12889-018-5353-5#Sec4>), to see what the overlap between the two networks are

However, I could not find a function in the igrapgh package that I could use for this. Therefore, I created a custom function that i want to share with you: 

```{r, echo=TRUE}
# Function for Jaccard index
jaccard_index<-function(g1,g2) {
  library(igraph)
  g1<-get.adjacency(g1)
  g1[g1 > 0.1] <- 1
  g2<-get.adjacency(g2)
  g2[g2 > 0.1] <- 1
  A<-sum(g1 != g2) # edges that changed (0->1 and 1->0)
  B<-sum(g1 * g2) # edges that have a 1 in M1 and 1 in M2, so stayed the same (1->1)
  return(round(B/sum(A,B),digits = 2)) # the ratio of stable ties ties (B), compared to all ties who change (A) + stable ties (B)
  on.exit(rm(A,B))
}
```

I can understand that you think this doesn't work. So let me show you.

I first created an empty matrix from ten by ten (as if there are 10 participants in this network), and randomly added 13 edges.

```{r, echo=TRUE}
set.seed(1337)
Test_Network_1<-matrix(nrow = 10, ncol = 10)
for (i in sample(1:10,13,replace=T)) {
  Test_Network_1[i,sample(1:10,1,replace=T)]<-1
}

```

Let us inspect the matrix and count the number of nominations in this matrix (should be 13).

```{r, echo=TRUE} 
print(Test_Network_1)
sum(Test_Network_1,na.rm=TRUE)
```

The make a partial overlapping network, we use the first example matrix and create a second:

``` {r, echo=TRUE }
Test_Network_2<-Test_Network_1
```

But these matrices will be identical, so let's delete some edges.

```{r, echo=TRUE }
# delete some  ties in the first network
Test_Network_1[2,8]<-NA
Test_Network_1[10,2]<-NA
Test_Network_1[9,9]<-NA

# delete some  ties in the second network
Test_Network_2[3,3]<-NA
Test_Network_2[4,4]<-NA
Test_Network_2[3,6]<-NA
Test_Network_2[8,5]<-NA
```

Now the first network should have 10 (13-3) edges, the second on should have 9 (13-4).
The networks share 6 edges (10-3-4 = 6)
Network 1 has 4 unique edges, network 2 has 3.

```{r, echo=TRUE}
# sum of network 1 should be 13-3 = 10
sum(Test_Network_1,na.rm=TRUE) == 10

# sum of network 2 should be 13-4=9
sum(Test_Network_2,na.rm=TRUE) == 9

# sum of edges in both graphs should be 13-3-4=6
sum(Test_Network_1==Test_Network_2,na.rm=TRUE)
```

Now that we have the example matrices, let's make two igraph objects:

```{r, echo=TRUE}
# make a network out of the matrices
Test_Graph_1<-graph_from_adjacency_matrix(Test_Network_1, mode = c("directed"))
Test_Graph_2<-graph_from_adjacency_matrix(Test_Network_2, mode = c("directed"))
```

Finally, let us test wether the example script works:

```{r, echo=TRUE }
# test of the function
jaccard_index(Test_Graph_1,Test_Graph_2)
```



# Step 2

Later in the process, I also wanted to understand where the changes between the ties were coming from. In other words, is one network overestimating the other?
 


```{r, echo=TRUE}
jaccard_change<-function(g1,g2) {
  library(igraph)
  g1<-get.adjacency(g1)
  g1[g1 > 0.1] <- 1
  g2<-get.adjacency(g2)
  g2[g2 > 0.1] <- 1
  Title<-"Numbers represent edges"
  Left<-sum(g1 > g2) # edges that changed (1->0)
  Right<-sum(g1 < g2) # edges that changed (0->1)
  Both<-sum(g1 * g2) # edges that have a 1 in M1 and 1 in M2, so stayed the same (1->1)
  Index<-round(Both/sum(Left,Right,Both),digits = 2) # the ratio of stable ties ties (B), compared to all ties who change (A) + stable ties (B)
  Results<-return(structure(list(Title,Index,Left,Right,Both),names=c("Title","Jaccard_Index","Left_Network_Only", "Right_Network_Only", "Both_Networks")))
  on.exit(rm(Left,Right,Both,Index))
}
```

<!--chapter:end:Jaccard.Rmd-->

